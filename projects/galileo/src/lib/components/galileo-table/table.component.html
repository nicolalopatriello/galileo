<div class="w-100 table-responsive gll-table-container"
     [ngStyle]="{'max-height': tableConfig?.maxHeight, 'min-height': tableConfig?.maxHeight}">
  <table class="table table-sm w-100 gll-table m-0">
    <thead>
    <tr id="tableHeader">
      <th *ngFor="let c of tableConfig?.columnsDef"
          scope="col"
          [style.width.px]="c.widthPx"
          [style.maxWidth.px]="c.widthPx"
      >{{isObs(c.headerName) ? (c.headerName | async) : c.headerName}}
        <ng-container *ngIf="c.popoverHelp">
          <fa-icon [ngbPopover]="popoverContainer" class="cursor-pointer"
                   [icon]="['far', 'question-circle']"></fa-icon>
          <ng-template #popoverContainer>
            <div class="p-1">
              {{c.popoverHelp.message}}
            </div>
            <div class="w-100 d-flex flex-row justify-content-end" *ngIf="c.popoverHelp.showGotItButton">
              <button class="btn-outline-primary btn btn-sm">
                {{'gotIt' | galileoTranslate | async}}
              </button>
            </div>
          </ng-template>
        </ng-container>
      </th>

      <th *ngIf="atLeastOneAction()" scope="col">
        {{'actions' | galileoTranslate | async}}
      </th>
    </tr>
    </thead>

    <tbody>
    <tr id="filtersRow" *ngIf="atLeastOneFilter()">
      <td *ngFor="let c of tableConfig?.columnsDef"
          [style.width.px]="c.widthPx"
          [style.maxWidth.px]="c.widthPx"
          class="p-1">
        <ng-container>
          <gll-filters *ngIf="c.filterConfig"
                       [columnField]="c.field"
                       [columnHeaderName]="isObs(c.headerName) ? (c.headerName | async) : c.headerName"
                       [columnFilterConfig]="c.filterConfig"
                       (columnFilterValue)="onColumnFilterValue($event)">
          </gll-filters>
        </ng-container>
      </td>
      <td *ngIf="atLeastOneAction()" class="p-1">
      </td>
    </tr>
    <!--
    Evaluate tu add a trackBy fn to table ngFor loop
    (e. g) let i = index; trackBy:trackByFn
    -->
    <tr class="tableRow" *ngFor="let r of data">
      <td *ngFor="let c of tableConfig?.columnsDef"
          [style.width.px]="c.widthPx"
          [style.maxWidth.px]="c.widthPx"
          (click)="rowSelected.emit(r)"
          [ngClass]="{'cursor-pointer': tableConfig?.cursorPointerOnRow, 'row-selected': !!tableConfig.isRowSelected ? tableConfig.isRowSelected(r) : false}">

        <ng-container *ngIf="!c.gllTableRenderer && !c.gllTableCustomRender">
          {{r[c.field]}}
        </ng-container>

        <ng-container *ngIf="c.gllTableCustomRender && !c.gllTableRenderer">
          {{c.gllTableCustomRender(r)}}
        </ng-container>

        <ng-container *ngIf="c.gllTableRenderer && !c.gllTableCustomRender">
          <ng-container [ngSwitch]="c.gllTableRenderer">
            <ng-container *ngSwitchCase="'gllTableCheckboxRenderer'">
              <input data-cy="gll-table-checkbox" type="checkbox"
                     [checked]="c.checkboxValue ? c.checkboxValue(r) : r[c.field]"
                     (click)="checkboxRendererEvent.emit({data: r, checked: $event.target.checked, field: c.field})"
                     class="cursor-pointer">
            </ng-container>
            <ng-container *ngSwitchCase="'gllTableDateTimeRenderer'">
              {{r[c.field] | date:'short'}}
            </ng-container>
            <ng-container *ngSwitchCase="'gllTableBooleanRenderer'">
              <fa-icon *ngIf="r[c.field] && !!c.trueFaIcon" [icon]="['fas', c.trueFaIcon.icon]"
                       [ngStyle]="{color: c.trueFaIcon.color}"></fa-icon>
              <fa-icon *ngIf="!r[c.field] && !!c.falseFaIcon" [icon]="['fas', c.falseFaIcon.icon]"
                       [ngStyle]="{color: c.falseFaIcon.color}"></fa-icon>
              <span *ngIf="!c.trueFaIcon || !c.falseFaIcon">{{r[c.field]}}</span>
            </ng-container>
          </ng-container>
        </ng-container>
      </td>

      <td *ngIf="atLeastOneAction()"
          style="width:1px; white-space:nowrap;"
          [ngClass]="{'row-selected': !!tableConfig.isRowSelected ? tableConfig.isRowSelected(r) : false}">

        <fa-icon [attr.data-cy]="'delete-action'"
                 (click)="onDelete(r)"
                 class="ml-1 mr-1 text-danger"
                 [ngClass]="{'cursor-pointer': !tableConfig?.actions?.delete?.disabled(r),
                 'text-black-50 no-pointer-event': tableConfig?.actions?.delete?.disabled(r),
                 'text-danger': !tableConfig?.actions?.delete?.disabled(r)}"
                 [icon]="['fas', 'trash-alt']"
                 *ngIf="isObs(tableConfig?.actions?.delete?.show) ? (tableConfig?.actions?.delete?.show | async) : tableConfig?.actions?.delete?.show">
        </fa-icon>


        <ng-container *ngFor="let e of tableConfig?.extraActions">
          <fa-icon [attr.data-cy]="e.iconColorProp.icon"
                   *ngIf="isObs(e.hide) ? !(e.hide | async) : !e.hide"
                   class="ml-1 mr-1"
                   [ngClass]="{'cursor-pointer': !e.disabled}"
                   [ngStyle]="{'color': !e.disabled ? e.iconColorProp.color : 'rgba(0, 0, 0, 0.5)'}"
                   [icon]="['fas', e.iconColorProp.icon]"
                   [ngbTooltip]="isObs(e.label) ? (e.label | async) : e.label" placement="bottom"
                   (click)="!e.disabled ? extraAction.emit({data: r, eventKey: e.eventKey}) : null"></fa-icon>
        </ng-container>
      </td>
    </tr>
    </tbody>
  </table>
  <div class="p-4 w-100 text-center" *ngIf="data?.length === 0" style="border: 1px solid gainsboro">
    {{isObs(tableConfig?.noDataMessage) ? (tableConfig?.noDataMessage | async) : tableConfig?.noDataMessage}}
  </div>
</div>
<div class="d-flex w-100 justify-content-end"
     *ngIf="tableConfig?.builtInPagination && tableConfig?.mode === 'clientSide'">
  <gll-pagination [numberOfPages]="clientSideInformation?.pagination.buckets?.length"
                  [currentPage]="clientSideInformation?.pagination.currentPage"
                  (selectPage)="onSelectPage($event)"></gll-pagination>
</div>


<ng-template #deleteRowDialog>
  <div class="modal-header bg-success text-light bg-danger">
    <h4 class="modal-title text-white">
      <fa-icon [icon]="['fas', 'trash']" class="text-white"></fa-icon>
      {{'delete' | galileoTranslate | async}}
    </h4>
  </div>
  <div class="modal-body">
    <p>{{'deleteMsg' | galileoTranslate | async}}</p>
    <ng-container *ngIf="showDeleteConfirmInput">
      <p class="mt-1 mb-1">{{'deleteConfirmInput' | galileoTranslate | async}}</p>
      <input ngbAutofocus [(ngModel)]="deleteConfirmInputValue" class="form-control" type="text">
    </ng-container>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-danger"
            [disabled]="showDeleteConfirmInput ? (deleteBtmDisabled() | async) : false"
            (click)="confirmDelete()">
      {{'delete' | galileoTranslate | async}}
    </button>
    <button ngbAutofocus type="button" class="btn btn-outline-secondary"
            (click)="cancelDelete()">
      {{'cancel' | galileoTranslate | async}}
    </button>
  </div>
</ng-template>


